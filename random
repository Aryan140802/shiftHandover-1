export const apiFetchFavorites = async () => {
  try {
    const userId = localStorage.getItem('uidd');
    const password = localStorage.getItem('password');
    
    const res = await api.post('/EISHome/postFavourites/', {
      userId: userId,
      password: password,
    });
    
    // If using axios (which api.post likely is), response data is in res.data
    const data = res.data;
    const favData = data.favourites;
    let favArray = [];
    
    // Ensure favData is handled correctly whether it's an array or a comma-separated string
    if (Array.isArray(favData)) {
      favArray = favData;
    } else if (typeof favData === 'string') {
      favArray = favData.split(',').map(item => item.trim()).filter(Boolean);
    }
    
    return favArray;
  } catch (err) {
    console.error('Failed to load favorites:', err);
    throw err;
  }
};

export const apiUpdateFavorites = async (updatedFavorites) => {
  try {
    const userId = localStorage.getItem('uidd');
    const password = localStorage.getItem('password');
    
    // Ensure updatedFavorites is always an array
    const favList = Array.isArray(updatedFavorites) ? updatedFavorites : [];
    
    const res = await api.post('/EISHome/postFavourites/', {
      userId: userId,
      password: password,
      favList: favList, // This must be an array
    });
    
    // If using axios, you don't need to check res.ok or call res.json()
    return res.data;
  } catch (error) {
    console.error('Failed to update favorites:', error);
    throw error;
  }
};
