document.addEventListener("DOMContentLoaded", async () => {
    const uid = localStorage.getItem('uidd');
    const sessionId = localStorage.getItem('sessionid');
    
    if (!uid || !sessionId) {
        console.log("No auth tokens - redirecting to login");
        redirectToLogin();
        return;
    }

    try {
        const response = await fetch('https://10.191.171.12:5443/EISHOME/awthenticationService/authenticatePortal/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${sessionId}`
            },
            body: JSON.stringify({ uid })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log("Auth response:", data);
        
        if (data.status === 302 || data.success === true) {
            console.log("Authentication successful");
            // Continue with app
        } else {
            console.log("Authentication failed - redirecting");
            redirectToLogin();
        }
    } catch (error) {
        console.error("Auth error:", error);
        redirectToLogin();
    }
});

function redirectToLogin() {
    const currentUrl = encodeURIComponent(window.location.href);
    window.location.href = `https://10.191.171.12:5443/EISHOME/?return_url=${currentUrl}`;
}
